/**
 * Build-time script to extract icon names from Font Awesome packages.
 * 
 * This iterates directly over the `fas` and `fab` exports (static, predictable objects)
 * and NOT over library.definitions (which depends on side effects and execution order).
 * 
 * Usage: npm run generate:icons
 */

import { fas } from '@fortawesome/free-solid-svg-icons';
import { fab } from '@fortawesome/free-brands-svg-icons';
import { writeFileSync, mkdirSync, existsSync } from 'fs';
import { dirname, join } from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Extract icon names from the icon definition objects
function extractIconNames(iconPack) {
    const names = new Set();

    for (const [key, iconDef] of Object.entries(iconPack)) {
        // Skip the 'prefix' and 'fas'/'fab' meta exports
        if (key === 'prefix' || key === 'fas' || key === 'fab') {
            continue;
        }

        // Each icon export (e.g., faPlay) has an iconName property
        if (iconDef && typeof iconDef === 'object' && 'iconName' in iconDef) {
            names.add(iconDef.iconName);
        }
    }

    return names;
}

// Extract from both solid and brands
const solidNames = extractIconNames(fas);
const brandsNames = extractIconNames(fab);

// Merge and deduplicate (some icons may exist in both packs with same name)
const allNames = new Set([...solidNames, ...brandsNames]);

// Sort alphabetically for consistent output
const sortedNames = Array.from(allNames).sort((a, b) => a.localeCompare(b));

// Generate TypeScript content
const content = `// Auto-generated file - DO NOT EDIT
// Generated by: npm run generate:icons
// Source: @fortawesome/free-solid-svg-icons, @fortawesome/free-brands-svg-icons

export const ICON_NAMES: string[] = [
${sortedNames.map(name => `    '${name}',`).join('\n')}
];
`;

// Output path
const outputDir = join(__dirname, '..', 'src', 'generated');
const outputPath = join(outputDir, 'iconNames.ts');

// Ensure directory exists
if (!existsSync(outputDir)) {
    mkdirSync(outputDir, { recursive: true });
}

// Write file
writeFileSync(outputPath, content, 'utf-8');

console.log(`✅ Generated ${sortedNames.length} icon names`);
console.log(`   → ${outputPath}`);
